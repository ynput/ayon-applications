<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=ui/process_monitor.html><link rel=next href=version.html><link rel=icon href=../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>utils - ayon-applications</title><link rel=stylesheet href=../../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../css/custom.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_applications.utils class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../index.html title=ayon-applications class="md-header__button md-logo" aria-label=ayon-applications data-md-component=logo> <img src=../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-applications </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> utils </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-applications title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title=ayon-applications class="md-nav__button md-logo" aria-label=ayon-applications data-md-component=logo> <img src=../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-applications </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-applications title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <label class=md-nav__link for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class=md-ellipsis> ayon_applications </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_applications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=addon.html class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class=md-nav__item> <a href=constants.html class=md-nav__link> <span class=md-ellipsis> constants </span> </a> </li> <li class=md-nav__item> <a href=defs.html class=md-nav__link> <span class=md-ellipsis> defs </span> </a> </li> <li class=md-nav__item> <a href=exceptions.html class=md-nav__link> <span class=md-ellipsis> exceptions </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=hooks/prelaunch_shell_windows.html class=md-nav__link> <span class=md-ellipsis> hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=manager.html class=md-nav__link> <span class=md-ellipsis> manager </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=plugins/publish/collect_app_name.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=process.html class=md-nav__link> <span class=md-ellipsis> process </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=ui/ansi_parser.html class=md-nav__link> <span class=md-ellipsis> ui </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> utils </span> <span class="md-nav__icon md-icon"></span> </label> <a href=utils.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> utils </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_applications.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.EnvironmentPrepData class=md-nav__link> <span class=md-ellipsis> EnvironmentPrepData </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.apply_project_environments_value class=md-nav__link> <span class=md-ellipsis> apply_project_environments_value </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_app_environments_for_context class=md-nav__link> <span class=md-ellipsis> get_app_environments_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_app_icon_path class=md-nav__link> <span class=md-ellipsis> get_app_icon_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_applications_for_context class=md-nav__link> <span class=md-ellipsis> get_applications_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_tools_for_context class=md-nav__link> <span class=md-ellipsis> get_tools_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.parse_environments class=md-nav__link> <span class=md-ellipsis> parse_environments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.prepare_app_environments class=md-nav__link> <span class=md-ellipsis> prepare_app_environments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.prepare_context_environments class=md-nav__link> <span class=md-ellipsis> prepare_context_environments </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../server/_backwards.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_applications.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.EnvironmentPrepData class=md-nav__link> <span class=md-ellipsis> EnvironmentPrepData </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.apply_project_environments_value class=md-nav__link> <span class=md-ellipsis> apply_project_environments_value </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_app_environments_for_context class=md-nav__link> <span class=md-ellipsis> get_app_environments_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_app_icon_path class=md-nav__link> <span class=md-ellipsis> get_app_icon_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_applications_for_context class=md-nav__link> <span class=md-ellipsis> get_applications_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.get_tools_for_context class=md-nav__link> <span class=md-ellipsis> get_tools_for_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.parse_environments class=md-nav__link> <span class=md-ellipsis> parse_environments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.prepare_app_environments class=md-nav__link> <span class=md-ellipsis> prepare_app_environments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_applications.utils.prepare_context_environments class=md-nav__link> <span class=md-ellipsis> prepare_context_environments </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>utils</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_applications.utils></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_applications.utils.EnvironmentPrepData class="doc doc-heading"> <code>EnvironmentPrepData</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=dict>dict</span></code></p> <p>Helper dictionary for storin temp data during environment prep.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Data must contain required keys.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>EnvironmentPrepData</span><span class=p>(</span><span class=nb>dict</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Helper dictionary for storin temp data during environment prep.</span>

<span class=sd>    Args:</span>
<span class=sd>        data (dict): Data must contain required keys.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>required_keys</span> <span class=o>=</span> <span class=p>(</span>
        <span class=s2>&quot;project_entity&quot;</span><span class=p>,</span>
        <span class=s2>&quot;folder_entity&quot;</span><span class=p>,</span>
        <span class=s2>&quot;task_entity&quot;</span><span class=p>,</span>
        <span class=s2>&quot;app&quot;</span><span class=p>,</span>
        <span class=s2>&quot;anatomy&quot;</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>required_keys</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>MissingRequiredKey</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;log&quot;</span><span class=p>):</span>
            <span class=n>data</span><span class=p>[</span><span class=s2>&quot;log&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>Logger</span><span class=o>.</span><span class=n>get_logger</span><span class=p>(</span><span class=s2>&quot;EnvironmentPrepData&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;env&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

        <span class=n>project_name</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;project_entity&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=s2>&quot;project_settings&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
            <span class=n>data</span><span class=p>[</span><span class=s2>&quot;project_settings&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.apply_project_environments_value class="doc doc-heading"> <code class="highlight language-python"><span class=n>apply_project_environments_value</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>env</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>env_group</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Apply project specific environments on passed environments.</p> <p>The environments are applied on passed <code>env</code> argument value so it is not required to apply changes back.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project for which environments should be received.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>env</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Environment values on which project specific environments will be applied.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Project settings for passed project name. Optional if project settings are already prepared.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dict</code></td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Passed env values with applied project environments.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=KeyError>KeyError</span></code> </td> <td> <div class=doc-md-description> <p>If project settings do not contain keys for project specific environments.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>apply_project_environments_value</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>env</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span>
    <span class=n>project_settings</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>env_group</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Apply project specific environments on passed environments.</span>

<span class=sd>    The environments are applied on passed `env` argument value so it is not</span>
<span class=sd>    required to apply changes back.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project for which environments should be</span>
<span class=sd>            received.</span>
<span class=sd>        env (dict): Environment values on which project specific environments</span>
<span class=sd>            will be applied.</span>
<span class=sd>        project_settings (dict): Project settings for passed project name.</span>
<span class=sd>            Optional if project settings are already prepared.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict: Passed env values with applied project environments.</span>

<span class=sd>    Raises:</span>
<span class=sd>        KeyError: If project settings do not contain keys for project specific</span>
<span class=sd>            environments.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>project_settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=n>env_value</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;core&quot;</span><span class=p>][</span><span class=s2>&quot;project_environments&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>env_value</span><span class=p>:</span>
        <span class=n>env_value</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>env_value</span><span class=p>)</span>
        <span class=n>parsed_value</span> <span class=o>=</span> <span class=n>parse_environments</span><span class=p>(</span><span class=n>env_value</span><span class=p>,</span> <span class=n>env_group</span><span class=p>)</span>
        <span class=n>env</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>compute_env_variables_structure</span><span class=p>(</span>
            <span class=n>merge_env_variables</span><span class=p>(</span><span class=n>parsed_value</span><span class=p>,</span> <span class=n>env</span><span class=p>)</span>
        <span class=p>))</span>
    <span class=k>return</span> <span class=n>env</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.get_app_environments_for_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_app_environments_for_context</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>folder_path</span><span class=p>,</span> <span class=n>task_name</span><span class=p>,</span> <span class=n>app_name</span><span class=p>,</span> <span class=n>env_group</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>launch_type</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>addons_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Prepare environment variables by context. Args: project_name (str): Name of project. folder_path (str): Folder path. task_name (str): Name of task. app_name (str): Name of application that is launched and can be found by ApplicationManager. env_group (Optional[str]): Name of environment group. If not passed default group is used. launch_type (Optional[str]): Type for which prelaunch hooks are executed. env (Optional[dict[str, str]]): Initial environment variables. <code>os.environ</code> is used when not passed. addons_manager (Optional[AddonsManager]): Initialized modules manager.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dict</code></td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Environments for passed context and application.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_app_environments_for_context</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>folder_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>task_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>app_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>env_group</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>launch_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>env</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>addons_manager</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AddonsManager</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prepare environment variables by context.</span>
<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project.</span>
<span class=sd>        folder_path (str): Folder path.</span>
<span class=sd>        task_name (str): Name of task.</span>
<span class=sd>        app_name (str): Name of application that is launched and can be found</span>
<span class=sd>            by ApplicationManager.</span>
<span class=sd>        env_group (Optional[str]): Name of environment group. If not passed</span>
<span class=sd>            default group is used.</span>
<span class=sd>        launch_type (Optional[str]): Type for which prelaunch hooks are</span>
<span class=sd>            executed.</span>
<span class=sd>        env (Optional[dict[str, str]]): Initial environment variables.</span>
<span class=sd>            `os.environ` is used when not passed.</span>
<span class=sd>        addons_manager (Optional[AddonsManager]): Initialized modules</span>
<span class=sd>            manager.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict: Environments for passed context and application.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Prepare app object which can be obtained only from ApplicationManager</span>
    <span class=n>app_manager</span> <span class=o>=</span> <span class=n>ApplicationManager</span><span class=p>()</span>
    <span class=n>context</span> <span class=o>=</span> <span class=n>app_manager</span><span class=o>.</span><span class=n>create_launch_context</span><span class=p>(</span>
        <span class=n>app_name</span><span class=p>,</span>
        <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>,</span>
        <span class=n>folder_path</span><span class=o>=</span><span class=n>folder_path</span><span class=p>,</span>
        <span class=n>task_name</span><span class=o>=</span><span class=n>task_name</span><span class=p>,</span>
        <span class=n>env_group</span><span class=o>=</span><span class=n>env_group</span><span class=p>,</span>
        <span class=n>launch_type</span><span class=o>=</span><span class=n>launch_type</span><span class=p>,</span>
        <span class=n>env</span><span class=o>=</span><span class=n>env</span><span class=p>,</span>
        <span class=n>addons_manager</span><span class=o>=</span><span class=n>addons_manager</span><span class=p>,</span>
        <span class=n>modules_manager</span><span class=o>=</span><span class=n>addons_manager</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=n>context</span><span class=o>.</span><span class=n>run_prelaunch_hooks</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>context</span><span class=o>.</span><span class=n>env</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.get_app_icon_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_app_icon_path</span><span class=p>(</span><span class=n>icon_filename</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get icon path.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>icon_filename</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Icon filename.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Union[str, None]: Icon path or None if not found.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_app_icon_path</span><span class=p>(</span><span class=n>icon_filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get icon path.</span>

<span class=sd>    Args:</span>
<span class=sd>        icon_filename (str): Icon filename.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[str, None]: Icon path or None if not found.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>icon_filename</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>None</span>
    <span class=n>icon_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>icon_filename</span><span class=p>)</span>
    <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>APPLICATIONS_ADDON_ROOT</span><span class=p>,</span> <span class=s2>&quot;icons&quot;</span><span class=p>,</span> <span class=n>icon_name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>path</span>
    <span class=k>return</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.get_applications_for_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_applications_for_context</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>folder_entity</span><span class=p>,</span> <span class=n>task_entity</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>project_entity</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get applications for context based on project settings.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>folder_entity</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Folder entity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_entity</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Task entity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=dict>dict</span>]</code> </td> <td> <div class=doc-md-description> <p>Project settings.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>project_entity</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=dict>dict</span>]</code> </td> <td> <div class=doc-md-description> <p>Project entity.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>list[str]: List of applications that can be used in given context.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_applications_for_context</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>folder_entity</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>task_entity</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>project_settings</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>project_entity</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get applications for context based on project settings.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project.</span>
<span class=sd>        folder_entity (dict): Folder entity.</span>
<span class=sd>        task_entity (dict): Task entity.</span>
<span class=sd>        project_settings (Optional[dict]): Project settings.</span>
<span class=sd>        project_entity (Optional[dict]): Project entity.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[str]: List of applications that can be used in given context.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>project_settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>apps_settings</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;applications&quot;</span><span class=p>]</span>

    <span class=c1># Use attributes to get available applications</span>
    <span class=c1># - this is older source of the information, will be deprecated in future</span>
    <span class=n>project_applications</span> <span class=o>=</span> <span class=n>apps_settings</span><span class=p>[</span><span class=s2>&quot;project_applications&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_applications</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
        <span class=k>if</span> <span class=n>project_entity</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>project_entity</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_project</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>apps</span> <span class=o>=</span> <span class=n>project_entity</span><span class=p>[</span><span class=s2>&quot;attrib&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;applications&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>apps</span> <span class=ow>or</span> <span class=p>[]</span>

    <span class=n>task_type</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>task_entity</span><span class=p>:</span>
        <span class=n>task_type</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;taskType&quot;</span><span class=p>]</span>

    <span class=n>profile</span> <span class=o>=</span> <span class=n>filter_profiles</span><span class=p>(</span>
        <span class=n>project_applications</span><span class=p>[</span><span class=s2>&quot;profiles&quot;</span><span class=p>],</span>
        <span class=p>{</span><span class=s2>&quot;task_types&quot;</span><span class=p>:</span> <span class=n>task_type</span><span class=p>}</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>profile</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>profile</span><span class=p>[</span><span class=s2>&quot;allow_type&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;applications&quot;</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>profile</span><span class=p>[</span><span class=s2>&quot;applications&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>_get_app_full_names_from_settings</span><span class=p>(</span><span class=n>apps_settings</span><span class=p>)</span>
    <span class=k>return</span> <span class=p>[]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.get_tools_for_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_tools_for_context</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>folder_entity</span><span class=p>,</span> <span class=n>task_entity</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get tools for context based on project settings.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>folder_entity</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Folder entity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_entity</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Task entity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=dict>dict</span>]</code> </td> <td> <div class=doc-md-description> <p>Project settings.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>list[str]: List of applications that can be used in given context.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_tools_for_context</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>folder_entity</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>task_entity</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>project_settings</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get tools for context based on project settings.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project.</span>
<span class=sd>        folder_entity (dict): Folder entity.</span>
<span class=sd>        task_entity (dict): Task entity.</span>
<span class=sd>        project_settings (Optional[dict]): Project settings.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[str]: List of applications that can be used in given context.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>project_settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>apps_settings</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;applications&quot;</span><span class=p>]</span>

    <span class=n>project_tools</span> <span class=o>=</span> <span class=n>apps_settings</span><span class=p>[</span><span class=s2>&quot;project_tools&quot;</span><span class=p>]</span>
    <span class=c1># Use attributes to get available tools</span>
    <span class=c1># - this is older source of the information, will be deprecated in future</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_tools</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
        <span class=n>tools</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>task_entity</span><span class=p>:</span>
            <span class=n>tools</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;attrib&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tools&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>tools</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>folder_entity</span><span class=p>:</span>
            <span class=n>tools</span> <span class=o>=</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;attrib&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tools&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>tools</span> <span class=ow>or</span> <span class=p>[]</span>

    <span class=n>folder_path</span> <span class=o>=</span> <span class=n>task_type</span> <span class=o>=</span> <span class=n>task_name</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>folder_entity</span><span class=p>:</span>
        <span class=n>folder_path</span> <span class=o>=</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>task_entity</span><span class=p>:</span>
        <span class=n>task_type</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;taskType&quot;</span><span class=p>]</span>
        <span class=n>task_name</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>

    <span class=n>profile</span> <span class=o>=</span> <span class=n>filter_profiles</span><span class=p>(</span>
        <span class=n>project_tools</span><span class=p>[</span><span class=s2>&quot;profiles&quot;</span><span class=p>],</span>
        <span class=p>{</span>
            <span class=s2>&quot;folder_paths&quot;</span><span class=p>:</span> <span class=n>folder_path</span><span class=p>,</span>
            <span class=s2>&quot;task_types&quot;</span><span class=p>:</span> <span class=n>task_type</span><span class=p>,</span>
            <span class=s2>&quot;task_names&quot;</span><span class=p>:</span> <span class=n>task_name</span><span class=p>,</span>
        <span class=p>},</span>
        <span class=n>keys_order</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;folder_paths&quot;</span><span class=p>,</span> <span class=s2>&quot;task_names&quot;</span><span class=p>,</span> <span class=s2>&quot;task_types&quot;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>profile</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>profile</span><span class=p>[</span><span class=s2>&quot;tools&quot;</span><span class=p>]</span>
    <span class=k>return</span> <span class=p>[]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.parse_environments class="doc doc-heading"> <code class="highlight language-python"><span class=n>parse_environments</span><span class=p>(</span><span class=n>env_data</span><span class=p>,</span> <span class=n>env_group</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>platform_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Parse environment values from settings byt group and platform.</p> <p>Data may contain up to 2 hierarchical levels of dictionaries. At the end of the last level must be string or list. List is joined using platform specific joiner (';' for windows and ':' for linux and mac).</p> <p>Hierarchical levels can contain keys for subgroups and platform name. Platform specific values must be always last level of dictionary. Platform names are "windows" (MS Windows), "linux" (any linux distribution) and "darwin" (any MacOS distribution).</p> <p>Subgroups are helpers added mainly for standard and on farm usage. Farm may require different environments for e.g. licence related values or plugins. Default subgroup is "standard".</p> <p>Examples:</p> <pre><code>{
    # Unchanged value
    &quot;ENV_KEY1&quot;: &quot;value&quot;,
    # Empty values are kept (unset environment variable)
    &quot;ENV_KEY2&quot;: &quot;&quot;,

    # Join list values with ':' or ';'
    &quot;ENV_KEY3&quot;: [&quot;value1&quot;, &quot;value2&quot;],

    # Environment groups
    &quot;ENV_KEY4&quot;: {
        &quot;standard&quot;: &quot;DEMO_SERVER_URL&quot;,
        &quot;farm&quot;: &quot;LICENCE_SERVER_URL&quot;
    },

    # Platform specific (and only for windows and mac)
    &quot;ENV_KEY5&quot;: {
        &quot;windows&quot;: &quot;windows value&quot;,
        &quot;darwin&quot;: [&quot;value 1&quot;, &quot;value 2&quot;]
    },

    # Environment groups and platform combination
    &quot;ENV_KEY6&quot;: {
        &quot;farm&quot;: &quot;FARM_VALUE&quot;,
        &quot;standard&quot;: {
            &quot;windows&quot;: [&quot;value1&quot;, &quot;value2&quot;],
            &quot;linux&quot;: &quot;value1&quot;,
            &quot;darwin&quot;: &quot;&quot;
        }
    }
}
</code></pre> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>parse_environments</span><span class=p>(</span>
    <span class=n>env_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>env_group</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>platform_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Parse environment values from settings byt group and platform.</span>

<span class=sd>    Data may contain up to 2 hierarchical levels of dictionaries. At the end</span>
<span class=sd>    of the last level must be string or list. List is joined using platform</span>
<span class=sd>    specific joiner (&#39;;&#39; for windows and &#39;:&#39; for linux and mac).</span>

<span class=sd>    Hierarchical levels can contain keys for subgroups and platform name.</span>
<span class=sd>    Platform specific values must be always last level of dictionary. Platform</span>
<span class=sd>    names are &quot;windows&quot; (MS Windows), &quot;linux&quot; (any linux distribution) and</span>
<span class=sd>    &quot;darwin&quot; (any MacOS distribution).</span>

<span class=sd>    Subgroups are helpers added mainly for standard and on farm usage. Farm</span>
<span class=sd>    may require different environments for e.g. licence related values or</span>
<span class=sd>    plugins. Default subgroup is &quot;standard&quot;.</span>

<span class=sd>    Examples:</span>
<span class=sd>    ```</span>
<span class=sd>    {</span>
<span class=sd>        # Unchanged value</span>
<span class=sd>        &quot;ENV_KEY1&quot;: &quot;value&quot;,</span>
<span class=sd>        # Empty values are kept (unset environment variable)</span>
<span class=sd>        &quot;ENV_KEY2&quot;: &quot;&quot;,</span>

<span class=sd>        # Join list values with &#39;:&#39; or &#39;;&#39;</span>
<span class=sd>        &quot;ENV_KEY3&quot;: [&quot;value1&quot;, &quot;value2&quot;],</span>

<span class=sd>        # Environment groups</span>
<span class=sd>        &quot;ENV_KEY4&quot;: {</span>
<span class=sd>            &quot;standard&quot;: &quot;DEMO_SERVER_URL&quot;,</span>
<span class=sd>            &quot;farm&quot;: &quot;LICENCE_SERVER_URL&quot;</span>
<span class=sd>        },</span>

<span class=sd>        # Platform specific (and only for windows and mac)</span>
<span class=sd>        &quot;ENV_KEY5&quot;: {</span>
<span class=sd>            &quot;windows&quot;: &quot;windows value&quot;,</span>
<span class=sd>            &quot;darwin&quot;: [&quot;value 1&quot;, &quot;value 2&quot;]</span>
<span class=sd>        },</span>

<span class=sd>        # Environment groups and platform combination</span>
<span class=sd>        &quot;ENV_KEY6&quot;: {</span>
<span class=sd>            &quot;farm&quot;: &quot;FARM_VALUE&quot;,</span>
<span class=sd>            &quot;standard&quot;: {</span>
<span class=sd>                &quot;windows&quot;: [&quot;value1&quot;, &quot;value2&quot;],</span>
<span class=sd>                &quot;linux&quot;: &quot;value1&quot;,</span>
<span class=sd>                &quot;darwin&quot;: &quot;&quot;</span>
<span class=sd>            }</span>
<span class=sd>        }</span>
<span class=sd>    }</span>
<span class=sd>    ```</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>env_data</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>output</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>env_group</span><span class=p>:</span>
        <span class=n>env_group</span> <span class=o>=</span> <span class=n>DEFAULT_ENV_SUBGROUP</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>platform_name</span><span class=p>:</span>
        <span class=n>platform_name</span> <span class=o>=</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>

    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>env_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
            <span class=c1># Look if any key is platform key</span>
            <span class=c1>#   - expect that represents environment group if does not contain</span>
            <span class=c1>#   platform keys</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>PLATFORM_NAMES</span><span class=o>.</span><span class=n>intersection</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>keys</span><span class=p>())):</span>
                <span class=c1># Skip the key if group is not available</span>
                <span class=k>if</span> <span class=n>env_group</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>value</span><span class=p>:</span>
                    <span class=k>continue</span>
                <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>[</span><span class=n>env_group</span><span class=p>]</span>

        <span class=c1># Check again if value is dictionary</span>
        <span class=c1>#   - this time there should be only platform keys</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>platform_name</span><span class=p>)</span>

        <span class=c1># Check if value is list and join it&#39;s values</span>
        <span class=c1># QUESTION Should empty values be skipped?</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)):</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>pathsep</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>

        <span class=c1># Set key to output if value is string</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
            <span class=n>output</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.prepare_app_environments class="doc doc-heading"> <code class="highlight language-python"><span class=n>prepare_app_environments</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>env_group</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>implementation_envs</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>addons_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Modify launch environments based on launched app and context.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><a class="autorefs autorefs-internal" title="EnvironmentPrepData (client.ayon_applications.utils.EnvironmentPrepData)" href=#client.ayon_applications.utils.EnvironmentPrepData>EnvironmentPrepData</a></code> </td> <td> <div class=doc-md-description> <p>Dictionary where result and intermediate result will be stored.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>prepare_app_environments</span><span class=p>(</span>
    <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
    <span class=n>env_group</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>implementation_envs</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
    <span class=n>addons_manager</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AddonsManager</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Modify launch environments based on launched app and context.</span>

<span class=sd>    Args:</span>
<span class=sd>        data (EnvironmentPrepData): Dictionary where result and intermediate</span>
<span class=sd>            result will be stored.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>app</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;app&quot;</span><span class=p>]</span>
    <span class=n>log</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;log&quot;</span><span class=p>]</span>
    <span class=n>source_env</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>addons_manager</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>addons_manager</span> <span class=o>=</span> <span class=n>AddonsManager</span><span class=p>()</span>

    <span class=n>_add_python_version_paths</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=n>source_env</span><span class=p>,</span> <span class=n>log</span><span class=p>,</span> <span class=n>addons_manager</span><span class=p>)</span>

    <span class=c1># Use environments from local settings</span>
    <span class=n>filtered_local_envs</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=c1># NOTE Overrides for environment variables are not implemented in AYON.</span>
    <span class=c1># project_settings = data[&quot;project_settings&quot;]</span>
    <span class=c1># whitelist_envs = project_settings[&quot;general&quot;].get(&quot;local_env_white_list&quot;)</span>
    <span class=c1># if whitelist_envs:</span>
    <span class=c1>#     local_settings = get_local_settings()</span>
    <span class=c1>#     local_envs = local_settings.get(&quot;environments&quot;) or {}</span>
    <span class=c1>#     filtered_local_envs = {</span>
    <span class=c1>#         key: value</span>
    <span class=c1>#         for key, value in local_envs.items()</span>
    <span class=c1>#         if key in whitelist_envs</span>
    <span class=c1>#     }</span>

    <span class=c1># Apply local environment variables for already existing values</span>
    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>filtered_local_envs</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>source_env</span><span class=p>:</span>
            <span class=n>source_env</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>

    <span class=c1># `app_and_tool_labels` has debug purpose</span>
    <span class=n>app_and_tool_labels</span> <span class=o>=</span> <span class=p>[</span><span class=n>app</span><span class=o>.</span><span class=n>full_name</span><span class=p>]</span>
    <span class=c1># Environments for application</span>
    <span class=n>environments</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>app</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>environment</span><span class=p>,</span>
        <span class=n>app</span><span class=o>.</span><span class=n>environment</span>
    <span class=p>]</span>

    <span class=n>tools</span> <span class=o>=</span> <span class=n>get_tools_for_context</span><span class=p>(</span>
        <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;project_name&quot;</span><span class=p>),</span>
        <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;folder_entity&quot;</span><span class=p>),</span>
        <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;task_entity&quot;</span><span class=p>),</span>
    <span class=p>)</span>

    <span class=c1># Add tools environments</span>
    <span class=n>groups_by_name</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>tool_by_group_name</span> <span class=o>=</span> <span class=n>collections</span><span class=o>.</span><span class=n>defaultdict</span><span class=p>(</span><span class=nb>dict</span><span class=p>)</span>
    <span class=n>used_tool_names</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>tools</span><span class=p>:</span>
        <span class=n>tool</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>manager</span><span class=o>.</span><span class=n>tools</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>tool</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>tool</span><span class=o>.</span><span class=n>is_valid_for_app</span><span class=p>(</span><span class=n>app</span><span class=p>):</span>
            <span class=k>continue</span>
        <span class=n>used_tool_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tool</span><span class=o>.</span><span class=n>full_name</span><span class=p>)</span>
        <span class=n>groups_by_name</span><span class=p>[</span><span class=n>tool</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool</span><span class=o>.</span><span class=n>group</span>
        <span class=n>tool_by_group_name</span><span class=p>[</span><span class=n>tool</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>name</span><span class=p>][</span><span class=n>tool</span><span class=o>.</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool</span>

    <span class=k>for</span> <span class=n>group_name</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>groups_by_name</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>
        <span class=n>group</span> <span class=o>=</span> <span class=n>groups_by_name</span><span class=p>[</span><span class=n>group_name</span><span class=p>]</span>
        <span class=n>environments</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>environment</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>tool_name</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>tool_by_group_name</span><span class=p>[</span><span class=n>group_name</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>
            <span class=n>tool</span> <span class=o>=</span> <span class=n>tool_by_group_name</span><span class=p>[</span><span class=n>group_name</span><span class=p>][</span><span class=n>tool_name</span><span class=p>]</span>
            <span class=n>environments</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tool</span><span class=o>.</span><span class=n>environment</span><span class=p>)</span>
            <span class=n>app_and_tool_labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tool</span><span class=o>.</span><span class=n>full_name</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
        <span class=s2>&quot;Will add environments for apps and tools: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>app_and_tool_labels</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>env_values</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>_env_values</span> <span class=ow>in</span> <span class=n>environments</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>_env_values</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=c1># Choose right platform</span>
        <span class=n>tool_env</span> <span class=o>=</span> <span class=n>parse_environments</span><span class=p>(</span><span class=n>_env_values</span><span class=p>,</span> <span class=n>env_group</span><span class=p>)</span>

        <span class=c1># Apply local environment variables</span>
        <span class=c1># - must happen between all values because they may be used during</span>
        <span class=c1>#   merge</span>
        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>filtered_local_envs</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>tool_env</span><span class=p>:</span>
                <span class=n>tool_env</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>

        <span class=c1># Merge dictionaries</span>
        <span class=n>env_values</span> <span class=o>=</span> <span class=n>merge_env_variables</span><span class=p>(</span><span class=n>tool_env</span><span class=p>,</span> <span class=n>env_values</span><span class=p>)</span>

    <span class=n>merged_env</span> <span class=o>=</span> <span class=n>merge_env_variables</span><span class=p>(</span><span class=n>env_values</span><span class=p>,</span> <span class=n>source_env</span><span class=p>)</span>
    <span class=n>loaded_env</span> <span class=o>=</span> <span class=n>compute_env_variables_structure</span><span class=p>(</span><span class=n>merged_env</span><span class=p>)</span>

    <span class=n>final_env</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=c1># Add host specific environments</span>
    <span class=k>if</span> <span class=n>app</span><span class=o>.</span><span class=n>host_name</span> <span class=ow>and</span> <span class=n>implementation_envs</span><span class=p>:</span>
        <span class=n>host_addon</span> <span class=o>=</span> <span class=n>addons_manager</span><span class=o>.</span><span class=n>get_host_addon</span><span class=p>(</span><span class=n>app</span><span class=o>.</span><span class=n>host_name</span><span class=p>)</span>
        <span class=n>add_implementation_envs</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>host_addon</span><span class=p>:</span>
            <span class=n>add_implementation_envs</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span>
                <span class=n>host_addon</span><span class=p>,</span> <span class=s2>&quot;add_implementation_envs&quot;</span><span class=p>,</span> <span class=kc>None</span>
            <span class=p>)</span>
        <span class=k>if</span> <span class=n>add_implementation_envs</span><span class=p>:</span>
            <span class=c1># Function may only modify passed dict without returning value</span>
            <span class=n>final_env</span> <span class=o>=</span> <span class=n>add_implementation_envs</span><span class=p>(</span><span class=n>loaded_env</span><span class=p>,</span> <span class=n>app</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>final_env</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>final_env</span> <span class=o>=</span> <span class=n>loaded_env</span>

    <span class=n>keys_to_remove</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>source_env</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>final_env</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>

    <span class=c1># Update env</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>final_env</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys_to_remove</span><span class=p>:</span>
        <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>][</span><span class=s2>&quot;AYON_APP_TOOLS&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;;&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>used_tool_names</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_applications.utils.prepare_context_environments class="doc doc-heading"> <code class="highlight language-python"><span class=n>prepare_context_environments</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>env_group</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>addons_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Modify launch environments with context data for launched host.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><a class="autorefs autorefs-internal" title="EnvironmentPrepData (client.ayon_applications.utils.EnvironmentPrepData)" href=#client.ayon_applications.utils.EnvironmentPrepData>EnvironmentPrepData</a></code> </td> <td> <div class=doc-md-description> <p>Dictionary where result and intermediate result will be stored.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_applications/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>prepare_context_environments</span><span class=p>(</span>
    <span class=n>data</span><span class=p>:</span> <span class=n>EnvironmentPrepData</span><span class=p>,</span>
    <span class=n>env_group</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>addons_manager</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AddonsManager</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Modify launch environments with context data for launched host.</span>

<span class=sd>    Args:</span>
<span class=sd>        data (EnvironmentPrepData): Dictionary where result and intermediate</span>
<span class=sd>            result will be stored.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Context environments</span>
    <span class=n>log</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;log&quot;</span><span class=p>]</span>

    <span class=n>project_entity</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;project_entity&quot;</span><span class=p>]</span>
    <span class=n>folder_entity</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;folder_entity&quot;</span><span class=p>]</span>
    <span class=n>task_entity</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;task_entity&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_entity</span><span class=p>:</span>
        <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
            <span class=s2>&quot;Skipping context environments preparation.&quot;</span>
            <span class=s2>&quot; Launch context does not contain required data.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=c1># Load project specific environments</span>
    <span class=n>project_name</span> <span class=o>=</span> <span class=n>project_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
    <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;project_settings&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>project_settings</span>

    <span class=n>app</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;app&quot;</span><span class=p>]</span>
    <span class=n>context_env</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;AYON_PROJECT_NAME&quot;</span><span class=p>:</span> <span class=n>project_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
        <span class=s2>&quot;AYON_APP_NAME&quot;</span><span class=p>:</span> <span class=n>app</span><span class=o>.</span><span class=n>full_name</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=n>folder_entity</span><span class=p>:</span>
        <span class=n>folder_path</span> <span class=o>=</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>
        <span class=n>context_env</span><span class=p>[</span><span class=s2>&quot;AYON_FOLDER_PATH&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>folder_path</span>

        <span class=k>if</span> <span class=n>task_entity</span><span class=p>:</span>
            <span class=n>context_env</span><span class=p>[</span><span class=s2>&quot;AYON_TASK_NAME&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>

    <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s2>&quot;Context environments set:</span><span class=se>\n</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>context_env</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>context_env</span><span class=p>)</span>

    <span class=c1># Apply project specific environments on current env value</span>
    <span class=c1># - apply them once the context environments are set</span>
    <span class=n>apply_project_environments_value</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>],</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>env_group</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>app</span><span class=o>.</span><span class=n>is_host</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>][</span><span class=s2>&quot;AYON_HOST_NAME&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>host_name</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_entity</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>task_entity</span><span class=p>:</span>
        <span class=c1># QUESTION replace with log.info and skip workfile discovery?</span>
        <span class=c1># - technically it should be possible to launch host without context</span>
        <span class=k>raise</span> <span class=n>ApplicationLaunchFailed</span><span class=p>(</span>
            <span class=s2>&quot;Host launch require folder and task context.&quot;</span>
        <span class=p>)</span>

    <span class=n>workdir_data</span> <span class=o>=</span> <span class=n>get_template_data</span><span class=p>(</span>
        <span class=n>project_entity</span><span class=p>,</span>
        <span class=n>folder_entity</span><span class=p>,</span>
        <span class=n>task_entity</span><span class=p>,</span>
        <span class=n>app</span><span class=o>.</span><span class=n>host_name</span><span class=p>,</span>
        <span class=n>project_settings</span>
    <span class=p>)</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;workdir_data&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>workdir_data</span>

    <span class=n>anatomy</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomy&quot;</span><span class=p>]</span>

    <span class=n>task_type</span> <span class=o>=</span> <span class=n>workdir_data</span><span class=p>[</span><span class=s2>&quot;task&quot;</span><span class=p>][</span><span class=s2>&quot;type&quot;</span><span class=p>]</span>
    <span class=c1># Temp solution how to pass task type to `_prepare_last_workfile`</span>
    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;task_type&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>task_type</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>workdir</span> <span class=o>=</span> <span class=n>get_workdir_with_workdir_data</span><span class=p>(</span>
            <span class=n>workdir_data</span><span class=p>,</span>
            <span class=n>anatomy</span><span class=o>.</span><span class=n>project_name</span><span class=p>,</span>
            <span class=n>anatomy</span><span class=p>,</span>
            <span class=n>project_settings</span><span class=o>=</span><span class=n>project_settings</span>
        <span class=p>)</span>

    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
        <span class=k>raise</span> <span class=n>ApplicationLaunchFailed</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Error in anatomy.format: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>workdir</span><span class=p>):</span>
        <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Creating workdir folder: </span><span class=se>\&quot;</span><span class=si>{</span><span class=n>workdir</span><span class=si>}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>workdir</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>ApplicationLaunchFailed</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;Couldn&#39;t create workdir because: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=p>)</span>

    <span class=n>data</span><span class=p>[</span><span class=s2>&quot;env&quot;</span><span class=p>][</span><span class=s2>&quot;AYON_WORKDIR&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>workdir</span>

    <span class=n>_prepare_last_workfile</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>workdir</span><span class=p>,</span> <span class=n>addons_manager</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>